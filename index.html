<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>一封特别的信</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap');
        body {
            font-family: 'Noto Serif SC', serif;
            line-height: 1.9;
            background-color: #fdfbf8;
            color: #4a4a4a;
            scroll-behavior: smooth;
        }
        h2 {
            font-weight: 700;
            margin-top: 3rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e2d8ce;
            color: #6d5f57;
            display: flex;
            align-items: center;
        }
        p {
            margin-bottom: 1.5rem;
            text-align: justify;
            hyphens: auto;
        }
        .content-section {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }
        .visible {
            opacity: 1;
            transform: translateY(0);
        }
        .symbol {
            font-size: 1.5rem;
            color: #b8a99c;
            margin-right: 0.75rem;
            line-height: 1;
        }
        .highlight {
             background-color: #f3ece4;
             padding: 0.1rem 0.4rem;
             border-radius: 5px;
             font-weight: bold;
             color: #5a4a42;
             white-space: nowrap;
        }
        blockquote {
            border-left: 3px solid #b8a99c;
            padding-left: 1.5rem;
            margin-left: 0.5rem;
            margin-right: 0.5rem;
            margin-top: 2rem;
            margin-bottom: 2rem;
            font-style: italic;
            color: #6d5f57;
        }
        .main-title {
            color: #5a4a42;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e2d8ce;
            margin-bottom: 3rem;
        }
        .signature {
            text-align: right;
            margin-top: 3rem;
            font-style: italic;
            color: #6d5f57;
        }

        /* --- Stili per la Modale Immagine (Lightbox) --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(30, 25, 20, 0.92); /* Overlay più scuro e caldo */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
            box-sizing: border-box;
            animation: fadeIn 0.3s ease-out;
        }
        .modal-content {
            max-width: 90vw;
            max-height: 90vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .modal-image {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            border-radius: 0.5rem; /* 8px */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            animation: zoomIn 0.3s ease-out;
        }
        .modal-close {
            position: absolute;
            top: -0.5rem; /* Posizionato leggermente sopra il contenuto */
            right: -0.5rem; /* Posizionato leggermente a destra del contenuto */
            font-size: 2rem;
            font-weight: bold;
            color: #d1c7bc;
            cursor: pointer;
            transition: color 0.2s, transform 0.2s;
            z-index: 1001;
            background-color: rgba(30, 25, 20, 0.7);
            border-radius: 50%;
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }
        .modal-close:hover {
            color: #ffffff;
            transform: scale(1.1);
        }

        /* Animazioni Modale */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes zoomIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        /* Nasconde elementi (usato da JS) */
        .hidden {
            display: none;
        }

    </style>
    <!-- Chosen Palette: Warm Neutrals (#fdfbf8, #e2d8ce, #b8a99c, #6d5f57, #5a4a42, #4a4a4a) -->
    <!-- Application Structure Plan: A single, scrollable page divided into logical sections mirroring the letter's flow (Introduction, Gift Part 1, Gift Part 2, NEW: Visuals Preview, Gift Part 3 - The Story, Conclusion). -->
    <!-- Visualization & Content Choices: Content: Letter text -> Goal: Present heartfelt message clearly -> Presentation: Formatted text blocks within sections -> Interaction: Scroll-based fade-in, Image modal lightbox -> Justification: Enhances reading flow and emotional impact -> Library/Method: HTML/CSS/JS. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-[#fdfbf8] text-[#4a4a4a]">

    <div class="container mx-auto max-w-2xl px-4 sm:px-6 py-16">
        <h1 class="text-4xl font-bold text-center main-title">一封特别的信</h1>

        <!-- Introduction Section -->
        <section id="intro" class="content-section mb-10">
            <p id="letter-greeting" class="text-lg"></p>
            <p id="letter-value"></p>
            <p id="letter-structure"></p>
            <p id="letter-parts-intro"></p>
            <p id="letter-explain-intro"></p>
        </section>

        <!-- Gift 1: Earrings -->
        <section id="gift-earrings" class="content-section mb-10">
            <h2><span class="symbol">🎁</span> 第一部分：耳环</h2>
            <p id="letter-earrings-intro"></p>
            <p id="letter-earrings-meaning"></p>
            <p id="letter-earrings-description"></p>
            <p id="letter-earrings-reveal"></p>
        </section>

        <!-- Gift 2: Music -->
        <section id="gift-music" class="content-section mb-10">
            <h2><span class="symbol">🎵</span> 第二部分：音乐</h2>
            <p id="letter-music-choice"></p>
            <p id="letter-music-title"></p>
            <p id="letter-music-effort"></p>
            <p id="letter-music-hope"></p>
        </section>

        <!-- NUOVA SEZIONE: Link Musica e Anteprima Illustrazione -->
        <section id="visual-preview" class="content-section mb-10">
            <h2><span class="symbol">🎹</span> 礼物补充：即兴演奏和插画</h2>
            
            <!-- Link Bilibili -->
            <p class="text-center mb-8 text-lg">
                这是我为你录制的钢琴即兴演奏：<br>
                <a href="https://www.bilibili.com/video/BV1xx411c7xX" target="_blank" rel="noopener noreferrer" class="text-[#6d5f57] hover:text-[#5a4a42] font-bold underline transition-colors duration-300 text-xl">
                    《一种情感的蜕变》
                </a>
            </p>

            <!-- Contenitore Immagine con Pre-loader -->
            <div id="image-loader" class="text-center text-[#b8a99c] my-4 py-10">
                <p>插画加载中...</p> <!-- Testo di caricamento -->
            </div>

            <div id="image-container" class="hidden my-6 cursor-pointer group"> <!-- 'hidden' finché non caricata -->
                <img id="preview-image" src="" alt="给佳倩的插画" class="w-full h-auto rounded-lg shadow-md transition-all duration-300 group-hover:shadow-xl group-hover:scale-[1.02]">
                <p class="text-center text-sm text-[#b8a99c] mt-3">（点击图片查看大图）</p>
            </div>
        </section>

        <!-- Gift 3: Illustration - The Story -->
        <section id="gift-illustration" class="content-section mb-10">
            <h2><span class="symbol">🎨</span> 第三部分：插画背后的故事</h2>
            <p id="letter-illustration-reasoning-intro"></p>
            <p id="letter-illustration-reciprocity"></p>
            <p id="letter-illustration-artist-choice"></p>
            <p id="letter-illustration-concept"></p>
            <p id="letter-illustration-participation"></p>
            <blockquote>
                <p id="letter-illustration-symbolism-stage"></p>
                <p id="letter-illustration-symbolism-piano"></p>
                <p id="letter-illustration-symbolism-lyrics"></p>
                <p id="letter-illustration-symbolism-pearl"></p>
                <p id="letter-illustration-symbolism-pearl-timing"></p>
            </blockquote>
            <p id="letter-illustration-process-intro"></p>
            <p id="letter-illustration-process-refs"></p>
            <p id="letter-illustration-process-hair"></p>
            <p id="letter-illustration-process-dress"></p>
            <p id="letter-illustration-process-difficulties"></p>
            <p id="letter-illustration-process-delivery"></p>
            <p id="letter-illustration-process-delivery-game" class="text-sm"></p>
            <p id="letter-illustration-process-delivery-bonus"></p>
            <p id="letter-illustration-process-avatar"></p>
        </section>

        <!-- Conclusion Section -->
        <section id="conclusion" class="content-section">
            <h2><span class="symbol">💖</span> 结语</h2>
            <p id="letter-conclusion-summary"></p>
            <p id="letter-conclusion-symbolism"></p>
            <p id="letter-conclusion-hope"></p>
            <p id="letter-conclusion-feedback"></p>
            <p id="letter-conclusion-acrostic"></p>
            <p id="letter-conclusion-birthday-wish" class="signature"></p>
        </section>

    </div>

    <!-- Modale Immagine (Lightbox) -->
    <div id="image-modal" class="modal-overlay hidden"> <!-- 'hidden' per nasconderla di default -->
        <div class="modal-content">
            <span id="modal-close" class="modal-close">&times;</span>
            <img id="modal-img" src="" alt="插画大图" class="modal-image">
        </div>
    </div>


    <script>
        // Store letter content in a structured object
        const letterContent = {
            greeting: "佳倩，\n\n给你。这是我为你准备的礼物。",
            value: "就像我今天早上那句简短的话里写的，今天是你的节日，你的农历生日。我为这一天思考了很久，想着如何向你表达我有多么珍惜我们的情谊。",
            structure: "我送给你的不是一份单独的礼物，而是由三部分组成的礼物，像是一条信息的三个片段，我希望它们合在一起能向你诉说些什么。",
            partsIntro: "第一部分是一份实物礼物，今天我们见面时我会亲手给你：一对耳环。第二部分是一份音乐礼物：一段大约10分钟的钢琴即兴演奏，是我为你录制的。第三部分就是这个，一份视觉礼物：一幅只为你创作的插画。",
            explainIntro: "我想为你解释这三个部分。",
            earringsIntro: "关于耳环，你亲眼看到就知道了。我为你选择了一款我认为可能很适合你、可以在不同场合佩戴、并且不过于张扬的款式。但同时，我也希望它带有一点意义。",
            earringsMeaning: "这对耳环的形状是一种叫做<span class='highlight'>“因提瓦特”</span>的虚构花朵。这种花是《原神》主角佩戴的。",
            earringsDescription: "它融合了蔷薇科、锦葵科和紫草科的一些元素，但又不完全属于其中任何一种。",
            earringsReveal: "我希望你亲眼看到它，所以建议你先不要去搜索它。",
            musicChoice: "音乐部分，我选择为你进行一次即兴演奏。即兴演奏不同于作曲；它是一种不可避免地更诚实的音乐创作方式。如果我悲伤，我的即兴演奏只会表达悲伤；如果我快乐，它将流露喜悦，等等。我的情感往往很复杂，无法用单一的词语来形容，更像是一种不断变化的状态。",
            musicTitle: "所以，我在几个月前录制了这段视频，并将这次即兴演奏命名为<span class='highlight'>“一种情感的蜕变”</span>。",
            musicEffort: "虽然即兴演奏的想法似乎很快就能完成，甚至有点懒惰，或者说花费的时间很短，但事实是为了达到这十分钟的音乐，我尝试了几十次，录制、筛选了好几个月。即兴创作出从头到尾既连贯又有说服力、既有逻辑又有灵魂、同时又能尝试与人沟通的音乐，是我所知最困难的事情之一。",
            musicHope: "我希望这段音乐，这个我最自然的声音，能够以某种方式触动你的心弦。",
            illustrationReasoningIntro: "最初，我认为这次即兴演奏加上耳环就足够作为完整的礼物了。但是，我越想越觉得，似乎还缺少点什么来使信息完整。因此，我决定再加入这幅插画。这是最复杂的部分，也是我最珍视的部分。",
            illustrationReciprocity: "当你送给我那幅由一位中国画师创作的云堇插画时，你给了我收到的最美的礼物之一。对你来说，这只是一种感谢的方式，但对我而言，它不仅仅是一幅画，它是一种纯粹的心意，一种深深打动我的举动。你看见了我，理解了我所爱，并把它赠予了我。",
            illustrationArtistChoice: "我想尝试让你体会同样的情感。\n\n我联系了我最信任、最喜欢的画师：<span class='highlight'>Lilack</span>，那位我想参与这个项目的唯一的日本画师。也许有技艺更高超的画师我可以去尝试联系，但对我来说，只有Lilack能够专门为你创作，理解我的意图，并以最大的关怀和注意力来完成作品。",
            illustrationConcept: "我的想法是创作一幅肖像画，画的不是某个角色，而是你。一幅不仅仅是“好看”，更能讲述你的故事和我们故事的肖像画。为此，我请求Lilack在画中加入许多隐藏的细节和象征，只有你才能完全理解。",
            illustrationParticipation: "我想把它们都告诉你，这样你就能“参与”到它的诞生过程中。",
            illustrationSymbolismStage: "你在舞台上，沐浴在聚光灯下。因为你是一位艺术家，一位歌者，那是你声音闪耀的地方。",
            illustrationSymbolismPiano: "你的身旁，阴影处，有一架三角钢琴。但钢琴家是看不见的。那架钢琴就是我，扮演着我最喜欢的角色：你的伴奏者。我就在那里，在舞台上与你同在，支持着你的声音而不被看见。",
            illustrationSymbolismLyrics: "在右侧，是<span class='highlight'>《敕勒歌》</span>的第一句歌词，这对你我来说都非常重要。我认为它是你热情和艺术的象征。Lilack用那些小星星和音符将它融入画中，营造出你正在那一刻歌唱的感觉。",
            illustrationSymbolismPearl: "如果你仔细看，你的左耳上佩戴着一个饰品。那是一只单独的<span class='highlight'>珍珠耳环</span>。这是我的秘密象征。它直接呼应了我为你创作的那首曲子<span class='highlight'>《沧海遗珠》</span>。",
            illustrationSymbolismPearlTiming: "这是我将为你创作的音乐与这幅你的画像联系起来的方式。这个最后的细节是在Lilack问我是否想添加饰品之后我才加上的；我认为这是统一这三份礼物的一个绝佳方式，也为这幅画增添了更多深度。",
            illustrationProcessIntro: "创作这幅作品本身就是一次冒险，因为出于对你隐私的尊重，我不能也不想直接给Lilack你的照片。我只能用语言来描述你。",
            illustrationProcessRefs: "我向他描述了你的脸型、你的眼睛、你的身高体型、你温柔宁静的神态。为了帮助他，我给了他一些“相似外貌”的角色作为参考：SAO的亚丝娜（为了那份温柔的眼神）和FFVII的蒂法（为了深色的头发和眼睛）。",
            illustrationProcessHair: "我们讨论了很多关于头发的问题！最后，我发了一张（打码的）照片给他，让他了解你的发际线、高额头以及你梳理刘海的方式。尽管打了码，Lilack甚至注意到并画上了你眼睛下方的那颗小痣！我们尝试了好几个版本才最终确定下来，但我认为这个版本令人满意。如果你看到我手机里的照片，你会看到这幅画逐步演变的过程，包括我们尝试过的各种发型。",
            illustrationProcessDress: "关于服装，最初我给了他一张和你多次穿过的那件带图案的黑裙子一模一样的照片，但在尝试之后，Lilack告诉我这太复杂了，画出来的效果不会令人满意。最终，我们选择了这件简洁而优雅的黑裙子，它完美地契合了场景和氛围。",
            illustrationProcessDifficulties: "总的来说，Lilack在完成这项工作时遇到了很多困难：想想看，他从未画过钢琴，对舞台的样子也没有真正的概念，甚至不知道歌手可以在没有麦克风的情况下唱歌。我给了他很多参考资料，包括真实和绘画的照片、视频，尽可能地帮助他。总的来说，这是一幅技术难度相当大的插画，因为它运用了大量的黑色调和深色。",
            illustrationProcessDelivery: "最后是交付环节。Lilack是一个非常可爱的人。他没有简单地把文件发给我。他设计了一个游戏。他准备了一系列7个带编号的zip文件，每个都用密码保护。",
            // Split the long game description for better readability potentially
            illustrationProcessDeliveryGame: "在我询问之后，他给了我第一个文件的密码；里面包含一个带有问题的文本文件，答案是当天的日期，我需要用这个日期作为密码来打开第二个zip文件。\n\n第二个zip文件里同样包含一个文本文件和另一个问题；答案是Lilack的生日，幸运的是我在他交付前几天问过他了。\n\n用这个日期我打开了第三个zip文件，里面问的是我的生日。用我的生日日期我打开了第四个zip文件，里面问的是你的生日。在第五个zip文件里，是最终的插画，有多种格式。\n\n此外，还有一段长长的文字，描述了他创作这幅插画的经历、他未来的打算、他希望未来能与我再次合作的愿望、以及他对日本以外世界的好奇（他从未出过国）。",
            illustrationProcessDeliveryBonus: "本可以就此结束，但在文件末尾，经过许多空格之后，还有另一个问题：云堇的生日日期。用这个日期我打开了第六个zip文件，里面包含一个长密码，用于打开第七个zip文件。在第七个zip文件里，是一个完全出乎意料的巨大惊喜：一幅<span class='highlight'>云堇穿着女仆装</span>的插画。",
            illustrationProcessAvatar: "我绝对没有要求过类似的东西，这纯粹是Lilack送的礼物。也正因如此，为了表达我的感激之情，我决定用它作为我的头像。所以我才对你说，给你看那张图的时候，说这个头像是因为你的礼物才有的，但它并不是你的礼物。这是Lilack表达感激的一种方式，在某种程度上，也是他自己对你送给我的那份礼物的一种回应，只不过是由Lilack亲手完成的。",
            conclusionSummary: "这份礼物，它的所有三个部分（耳环、音乐、插画），是我对你说“谢谢”的方式。",
            conclusionSymbolism: "我今天会给你的耳环是实物的象征。画中的珍珠是艺术的象征。而音乐是情感的象征。它们都是相互关联的。",
            conclusionHope: "我全心全意地希望你喜欢这份礼物，希望你能感受到我（以及Lilack，以他自己的方式！）在创作它时所投入的全部关怀、时间和情感。",
            conclusionFeedback: "请告诉我你是否喜欢它。❤️",
            conclusionAcrostic: "最后……你收到今天信息的所有部分了吗？你完成最后一个藏头诗了吗？\n（如果你有困难，就像第二次那样，我可以给你一个提示哦！😉）",
            conclusionBirthdayWish: "农历生日快乐，佳倩。✨"
        };

        // Function to render letter content into the HTML elements
        function renderLetter() {
            Object.keys(letterContent).forEach(key => {
                const elementId = `letter-${key.replace(/([A-Z])/g, '-$1').toLowerCase()}`; // Convert camelCase to kebab-case
                let element = document.getElementById(elementId);

                if (element) {
                    // Use innerHTML if content contains HTML tags (like spans for highlights)
                    if (letterContent[key].includes('<span')) {
                        // Preserve double line breaks as <br><br>, single as <br>
                        element.innerHTML = letterContent[key].replace(/\n\n/g, '<br><br>').replace(/\n/g, '<br>');
                    } else {
                        // Use innerText for plain text, preserve line breaks by replacing \n with <br> inside innerHTML
                         element.innerHTML = letterContent[key].replace(/\n\n/g, '<br><br>').replace(/\n/g, '<br>');
                    }
                } else {
                     console.error(`Element with ID ${elementId} not found.`);
                }
            });
        }

        // Simple fade-in animation on scroll
        function revealSections() {
            const sections = document.querySelectorAll('.content-section');
            const windowHeight = window.innerHeight;

            sections.forEach(section => {
                const sectionTop = section.getBoundingClientRect().top;
                // Reveal when the top of the section is within the viewport, with a small offset
                if (sectionTop < windowHeight - 50) {
                    section.classList.add('visible');
                } else {
                    // Optional: Hide again if scrolled back up far enough
                    if (sectionTop > windowHeight) {
                       // section.classList.remove('visible');
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderLetter();
            
            // Trigger initial animation slightly delayed to ensure styles are applied
            setTimeout(() => {
                revealSections();
            }, 100);
            
            // Add scroll listener
            window.addEventListener('scroll', revealSections);

            
            // --- NUOVA Logica per Immagine e Modale ---

            // 1. Pre-caricamento Immagine
            const imageLoader = document.getElementById('image-loader');
            const imageContainer = document.getElementById('image-container');
            const previewImage = document.getElementById('preview-image');
            
            const smallImagePath = '依頼絵.webp'; // Immagine piccola
            const largeImagePath = '依頼絵.png'; // Immagine grande
            
            const memoryImage = new Image();
            memoryImage.src = smallImagePath;

            // Quando l'immagine .webp è stata scaricata in memoria...
            memoryImage.onload = () => {
                previewImage.src = smallImagePath; // Imposta l'src dell'immagine visibile
                imageLoader.classList.add('hidden'); // Nascondi il testo "Caricamento..."
                imageContainer.classList.remove('hidden'); // Mostra l'immagine
            };
            
            // Gestione errore caricamento
            memoryImage.onerror = () => {
                imageLoader.innerHTML = '<p>图片加载失败。</p>'; // Immagine non caricata
            };

            // 2. Logica Modale (Lightbox)
            const modal = document.getElementById('image-modal');
            const modalImg = document.getElementById('modal-img');
            const closeModal = document.getElementById('modal-close');

            // Apre la modale
            imageContainer.addEventListener('click', () => {
                modalImg.src = largeImagePath; // Carica l'immagine grande
                modal.classList.remove('hidden'); // Mostra la modale
            });

            // Chiude la modale (click sulla X)
            closeModal.addEventListener('click', () => {
                modal.classList.add('hidden');
                modalImg.src = ''; // Svuota l'src per fermare il caricamento
            });

            // Chiude la modale (click sull'overlay di sfondo)
            modal.addEventListener('click', (e) => {
                if (e.target === modal) { // Solo se si clicca sullo sfondo
                    modal.classList.add('hidden');
                    modalImg.src = ''; 
                }
            });

            // Chiude la modale premendo il tasto Esc
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
                    modal.classList.add('hidden');
                    modalImg.src = '';
                }
            });
            // --- Fine Nuova Logica ---
        });

    </script>

</body>
</html>
